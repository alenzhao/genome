#!/usr/bin/env genome-perl

BEGIN { 
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
}

use strict;
use warnings;

use above "Genome";
use Test::More;

my $pkg = 'Genome::Qc::Tool::Samtools::Flagstat';
use_ok($pkg);

my $data_dir = __FILE__.".d";

my $output_file = File::Spec->join($data_dir, 'output_file.txt');
my $temp_file = Genome::Sys->create_temp_file_path;

my $tool = $pkg->create(
    gmt_params => {
        'bam-file' => $temp_file,
        'output-file' => $output_file,
    }
);
ok($tool->isa($pkg), 'Tool created successfully');

my @expected_cmd_line =(
    'gmt',
    'sam',
    'flagstat',
    sprintf('--output-file=%s', $output_file),
    sprintf('--bam-file=%s', $temp_file),
);
is_deeply([$tool->cmd_line], [@expected_cmd_line], 'Command line list as expected');

my %expected_metrics = (
    pct_interchromosomal_mappings => '0.0145251396648045',
);
is_deeply({$tool->get_metrics}, {%expected_metrics}, 'Parsed metrics as expected');

done_testing;
