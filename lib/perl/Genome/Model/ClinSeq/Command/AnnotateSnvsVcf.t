#!/usr/bin/env genome-perl

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
}

use strict;
use warnings;

use above "Genome";
use Test::More;
use Genome::Utility::Test qw (compare_ok);
use Genome::Test::Factory::SoftwareResult::User;

my $pkg = 'Genome::Model::ClinSeq::Command::AnnotateSnvsVcf';
use_ok($pkg);

my $test_dir = __FILE__.'.d';
my $input_file = File::Spec->join($test_dir, 'snvs.vcf');
my $annotation_file = File::Spec->join($test_dir, 'annotation.vcf');
my $result_users = Genome::Test::Factory::SoftwareResult::User->setup_user_hash;

my $cmd = $pkg->create(
    input_file => $input_file,
    annotation_file => $annotation_file,
    info => 0,
    result_users => $result_users,
);
isa_ok($cmd, $pkg);
ok($cmd->execute, 'Command executes correctly');

my $result = $cmd->output_result;
isa_ok($result, 'Genome::Model::ClinSeq::Command::AnnotateSnvsVcf::Result');
compare_ok($result->file_path, File::Spec->join($test_dir, 'expected', 'snvs.annotated.vcf'), 'File content as expected');

done_testing;
