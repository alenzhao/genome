<?xml version="1.0"?>
<operation name="Import Instrument Data">
  <operationtype typeClass="Workflow::OperationType::Model">
    <inputproperty>analysis_project</inputproperty>
    <inputproperty>downsample_ratio</inputproperty>
    <inputproperty>instrument_data_properties</inputproperty>
    <inputproperty>library</inputproperty>
    <inputproperty>source_paths</inputproperty>
    <inputproperty>working_directory</inputproperty>
    <outputproperty>instrument_data</outputproperty>
  </operationtype>
  <operation name="create instrument data">
    <operationtype typeClass="Workflow::OperationType::Command" commandClass="Genome::InstrumentData::Command::Import::WorkFlow::CreateInstrumentData">
      <inputproperty>analysis_project</inputproperty>
      <inputproperty>bam_paths</inputproperty>
      <inputproperty>instrument_data_properties</inputproperty>
      <inputproperty>library</inputproperty>
      <inputproperty>source_md5s</inputproperty>
      <outputproperty>instrument_data</outputproperty>
      <outputproperty>result</outputproperty>
    </operationtype>
  </operation>
  <operation name="downsample bam">
    <operationtype typeClass="Workflow::OperationType::Command" commandClass="Genome::InstrumentData::Command::Import::WorkFlow::DownsampleBam">
      <inputproperty>bam_path</inputproperty>
      <inputproperty>downsample_ratio</inputproperty>
      <outputproperty>output_bam_path</outputproperty>
      <outputproperty>result</outputproperty>
    </operationtype>
  </operation>
  <operation name="retrieve source path from local disk">
    <operationtype typeClass="Workflow::OperationType::Command" commandClass="Genome::InstrumentData::Command::Import::WorkFlow::RetrieveSourcePathFromLocalDisk">
      <inputproperty>source_path</inputproperty>
      <inputproperty>working_directory</inputproperty>
      <outputproperty>destination_original_md5_path</outputproperty>
      <outputproperty>destination_path</outputproperty>
      <outputproperty>result</outputproperty>
    </operationtype>
  </operation>
  <operation name="sanitize bam">
    <operationtype typeClass="Workflow::OperationType::Command" commandClass="Genome::InstrumentData::Command::Import::WorkFlow::SanitizeBam">
      <inputproperty>bam_path</inputproperty>
      <outputproperty>output_bam_path</outputproperty>
      <outputproperty>result</outputproperty>
    </operationtype>
  </operation>
  <operation name="sort bam">
    <operationtype typeClass="Workflow::OperationType::Command" commandClass="Genome::InstrumentData::Command::Import::WorkFlow::SortBam">
      <inputproperty>bam_path</inputproperty>
      <outputproperty>output_bam_path</outputproperty>
      <outputproperty>result</outputproperty>
    </operationtype>
  </operation>
  <operation name="split bam by read group">
    <operationtype typeClass="Workflow::OperationType::Command" commandClass="Genome::InstrumentData::Command::Import::WorkFlow::SplitBamByReadGroup">
      <inputproperty>bam_path</inputproperty>
      <outputproperty>output_bam_paths</outputproperty>
      <outputproperty>result</outputproperty>
    </operationtype>
  </operation>
  <operation name="verify not imported">
    <operationtype typeClass="Workflow::OperationType::Command" commandClass="Genome::InstrumentData::Command::Import::WorkFlow::VerifyNotImported">
      <inputproperty>source_path</inputproperty>
      <inputproperty>working_directory</inputproperty>
      <outputproperty>result</outputproperty>
      <outputproperty>source_md5</outputproperty>
      <outputproperty>source_path</outputproperty>
    </operationtype>
  </operation>
  <link fromOperation="create instrument data" fromProperty="instrument_data" toOperation="output connector" toProperty="instrument_data"/>
  <link fromOperation="downsample bam" fromProperty="output_bam_path" toOperation="split bam by read group" toProperty="bam_path"/>
  <link fromOperation="input connector" fromProperty="analysis_project" toOperation="create instrument data" toProperty="analysis_project"/>
  <link fromOperation="input connector" fromProperty="instrument_data_properties" toOperation="create instrument data" toProperty="instrument_data_properties"/>
  <link fromOperation="input connector" fromProperty="library" toOperation="create instrument data" toProperty="library"/>
  <link fromOperation="input connector" fromProperty="downsample_ratio" toOperation="downsample bam" toProperty="downsample_ratio"/>
  <link fromOperation="input connector" fromProperty="source_paths" toOperation="retrieve source path from local disk" toProperty="source_path"/>
  <link fromOperation="input connector" fromProperty="working_directory" toOperation="retrieve source path from local disk" toProperty="working_directory"/>
  <link fromOperation="input connector" fromProperty="working_directory" toOperation="verify not imported" toProperty="working_directory"/>
  <link fromOperation="retrieve source path from local disk" fromProperty="destination_path" toOperation="verify not imported" toProperty="source_path"/>
  <link fromOperation="sanitize bam" fromProperty="output_bam_path" toOperation="downsample bam" toProperty="bam_path"/>
  <link fromOperation="sort bam" fromProperty="output_bam_path" toOperation="sanitize bam" toProperty="bam_path"/>
  <link fromOperation="split bam by read group" fromProperty="output_bam_paths" toOperation="create instrument data" toProperty="bam_paths"/>
  <link fromOperation="verify not imported" fromProperty="source_md5" toOperation="create instrument data" toProperty="source_md5s"/>
  <link fromOperation="verify not imported" fromProperty="source_path" toOperation="sort bam" toProperty="bam_path"/>
</operation>
