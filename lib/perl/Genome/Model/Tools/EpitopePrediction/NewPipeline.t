#!/usr/bin/env genome-perl

use strict;
use warnings FATAL => 'all';

use Test::More;
use above 'Genome';
use Genome::Model::SomaticVariation::Command::TestHelpers qw(
    create_test_objects
);
use Genome::VariantReporting::Framework::TestHelpers qw(
    test_dag_xml
);

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
};

my $pkg = 'Genome::Model::Tools::EpitopePrediction::NewPipeline';
use_ok($pkg);

my $TEST_DATA_VERSION = 10;
my $test_data_pkg = 'Genome::Model::SomaticVariation::Command::CreateReport';
my $test_data_dir = Genome::Utility::Test->data_dir_ok($test_data_pkg, $TEST_DATA_VERSION);

my $cmd = $pkg->create(
    model => create_test_objects($test_data_dir),
    alleles => ['HLA-A02:01'],
    output_filter => 'top',
    epitope_length => 10,
    output_directory => 'test',
);
isa_ok($cmd, $pkg);

$DB::single=1;
test_dag_xml($cmd->dag, __FILE__);

done_testing();
