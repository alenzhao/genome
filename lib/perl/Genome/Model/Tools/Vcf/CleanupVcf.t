#!/usr/bin/env genome-perl

use strict;
use warnings;

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
}

use above 'Genome';
use Test::More tests => 4;
use Genome::Utility::Vcf "diff_vcf_file_vs_file";
use File::Temp;

use_ok('Genome::Model::Tools::Vcf::CleanupVcf');

my $test_data_directory = join('/', Genome::Config::get('test_inputs'), 'Genome-Model-Tools-Vcf-CleanupVcf');
diag("Test data located at: $test_data_directory");

my $output_directory = File::Temp::tempdir(
    'Genome-Model-Tools-Vcf-CleanupVcf-XXXXX',
    TMPDIR => 1,
    CLEANUP => 1
);

my $input = join('/', $test_data_directory, 'input.vcf.gz');
my $expected_result = join('/', $test_data_directory, 'output.vcf.gz');
my $result = join('/', $output_directory, 'test_output.vcf.gz');

my $cmd = Genome::Model::Tools::Vcf::CleanupVcf->create(
    input_file => $input,
    output_file => $result
);

ok($cmd, "Created CleanupVcf object");
ok($cmd->execute(), "Executed CleanupVcf");

my $diff = diff_vcf_file_vs_file($result, $expected_result);
ok(!$diff, 'Output matches expected result') 
    or diag("diff results:\n" . $diff);
